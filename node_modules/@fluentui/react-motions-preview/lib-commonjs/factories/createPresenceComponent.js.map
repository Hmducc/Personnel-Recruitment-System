{"version":3,"sources":["createPresenceComponent.js"],"sourcesContent":["import { useEventCallback, useFirstMount, useIsomorphicLayoutEffect, useMergedRefs } from '@fluentui/react-utilities';\nimport * as React from 'react';\nimport { PresenceGroupChildContext } from '../contexts/PresenceGroupChildContext';\nimport { useIsReducedMotion } from '../hooks/useIsReducedMotion';\nimport { useMotionImperativeRef } from '../hooks/useMotionImperativeRef';\nimport { useMountedState } from '../hooks/useMountedState';\nimport { animate } from '../utils/animate';\nimport { getChildElement } from '../utils/getChildElement';\nfunction shouldSkipAnimation(appear, isFirstMount, visible) {\n    return !appear && isFirstMount && visible;\n}\nexport function createPresenceComponent(motion) {\n    const Presence = (props)=>{\n        const itemContext = React.useContext(PresenceGroupChildContext);\n        const { appear, children, imperativeRef, onMotionFinish, visible, unmountOnExit } = {\n            ...itemContext,\n            ...props\n        };\n        const [mounted, setMounted] = useMountedState(visible, unmountOnExit);\n        const child = getChildElement(children);\n        const animationRef = useMotionImperativeRef(imperativeRef);\n        const elementRef = React.useRef();\n        const ref = useMergedRefs(elementRef, child.ref);\n        const optionsRef = React.useRef({});\n        const isFirstMount = useFirstMount();\n        const isReducedMotion = useIsReducedMotion();\n        const onEnterFinish = useEventCallback((event)=>{\n            onMotionFinish === null || onMotionFinish === void 0 ? void 0 : onMotionFinish(event, {\n                event,\n                type: 'animation',\n                direction: 'enter'\n            });\n        });\n        const onExitFinish = useEventCallback((event)=>{\n            onMotionFinish === null || onMotionFinish === void 0 ? void 0 : onMotionFinish(event, {\n                event,\n                type: 'animation',\n                direction: 'exit'\n            });\n            if (unmountOnExit) {\n                setMounted(false);\n                itemContext === null || itemContext === void 0 ? void 0 : itemContext.onExit();\n            }\n        });\n        useIsomorphicLayoutEffect(()=>{\n            optionsRef.current = {\n                appear\n            };\n        });\n        useIsomorphicLayoutEffect(()=>{\n            if (!elementRef.current || shouldSkipAnimation(optionsRef.current.appear, isFirstMount, visible)) {\n                return;\n            }\n            const presenceDefinition = typeof motion === 'function' ? motion(elementRef.current) : motion;\n            const { keyframes, ...options } = visible ? presenceDefinition.enter : presenceDefinition.exit;\n            const animation = animate(elementRef.current, keyframes, {\n                fill: 'forwards',\n                ...options,\n                ...isReducedMotion() && {\n                    duration: 1\n                }\n            });\n            if (!animation) {\n                return;\n            }\n            if (!visible && isFirstMount) {\n                // Heads up!\n                // .finish() is used there to skip animation on first mount, but apply animation styles immediately\n                animation.finish();\n                return;\n            }\n            animationRef.current = animation;\n            animation.onfinish = visible ? onEnterFinish : onExitFinish;\n            return ()=>{\n                animation.cancel();\n            };\n        }, // Excluding `isFirstMount` from deps to prevent re-triggering the animation on subsequent renders\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [\n            animationRef,\n            isReducedMotion,\n            onEnterFinish,\n            onExitFinish,\n            visible\n        ]);\n        if (mounted) {\n            return React.cloneElement(child, {\n                ref\n            });\n        }\n        return null;\n    };\n    return Presence;\n}\n"],"names":["createPresenceComponent","shouldSkipAnimation","appear","isFirstMount","visible","motion","Presence","props","itemContext","React","useContext","PresenceGroupChildContext","children","imperativeRef","onMotionFinish","unmountOnExit","mounted","setMounted","useMountedState","child","getChildElement","animationRef","useMotionImperativeRef","elementRef","useRef","ref","useMergedRefs","optionsRef","useFirstMount","isReducedMotion","useIsReducedMotion","onEnterFinish","useEventCallback","event","type","direction","onExitFinish","onExit","useIsomorphicLayoutEffect","current","presenceDefinition","keyframes","options","enter","exit","animation","animate","fill","duration","finish","onfinish","cancel","cloneElement"],"mappings":";;;;+BAWgBA;;;eAAAA;;;;gCAX0E;iEACnE;2CACmB;oCACP;wCACI;iCACP;yBACR;iCACQ;AAChC,SAASC,oBAAoBC,MAAM,EAAEC,YAAY,EAAEC,OAAO;IACtD,OAAO,CAACF,UAAUC,gBAAgBC;AACtC;AACO,SAASJ,wBAAwBK,MAAM;IAC1C,MAAMC,WAAW,CAACC;QACd,MAAMC,cAAcC,OAAMC,UAAU,CAACC,oDAAyB;QAC9D,MAAM,EAAET,MAAM,EAAEU,QAAQ,EAAEC,aAAa,EAAEC,cAAc,EAAEV,OAAO,EAAEW,aAAa,EAAE,GAAG;YAChF,GAAGP,WAAW;YACd,GAAGD,KAAK;QACZ;QACA,MAAM,CAACS,SAASC,WAAW,GAAGC,IAAAA,gCAAe,EAACd,SAASW;QACvD,MAAMI,QAAQC,IAAAA,gCAAe,EAACR;QAC9B,MAAMS,eAAeC,IAAAA,8CAAsB,EAACT;QAC5C,MAAMU,aAAad,OAAMe,MAAM;QAC/B,MAAMC,MAAMC,IAAAA,6BAAa,EAACH,YAAYJ,MAAMM,GAAG;QAC/C,MAAME,aAAalB,OAAMe,MAAM,CAAC,CAAC;QACjC,MAAMrB,eAAeyB,IAAAA,6BAAa;QAClC,MAAMC,kBAAkBC,IAAAA,sCAAkB;QAC1C,MAAMC,gBAAgBC,IAAAA,gCAAgB,EAAC,CAACC;YACpCnB,mBAAmB,QAAQA,mBAAmB,KAAK,IAAI,KAAK,IAAIA,eAAemB,OAAO;gBAClFA;gBACAC,MAAM;gBACNC,WAAW;YACf;QACJ;QACA,MAAMC,eAAeJ,IAAAA,gCAAgB,EAAC,CAACC;YACnCnB,mBAAmB,QAAQA,mBAAmB,KAAK,IAAI,KAAK,IAAIA,eAAemB,OAAO;gBAClFA;gBACAC,MAAM;gBACNC,WAAW;YACf;YACA,IAAIpB,eAAe;gBACfE,WAAW;gBACXT,gBAAgB,QAAQA,gBAAgB,KAAK,IAAI,KAAK,IAAIA,YAAY6B,MAAM;YAChF;QACJ;QACAC,IAAAA,yCAAyB,EAAC;YACtBX,WAAWY,OAAO,GAAG;gBACjBrC;YACJ;QACJ;QACAoC,IAAAA,yCAAyB,EAAC;YACtB,IAAI,CAACf,WAAWgB,OAAO,IAAItC,oBAAoB0B,WAAWY,OAAO,CAACrC,MAAM,EAAEC,cAAcC,UAAU;gBAC9F;YACJ;YACA,MAAMoC,qBAAqB,OAAOnC,WAAW,aAAaA,OAAOkB,WAAWgB,OAAO,IAAIlC;YACvF,MAAM,EAAEoC,SAAS,EAAE,GAAGC,SAAS,GAAGtC,UAAUoC,mBAAmBG,KAAK,GAAGH,mBAAmBI,IAAI;YAC9F,MAAMC,YAAYC,IAAAA,gBAAO,EAACvB,WAAWgB,OAAO,EAAEE,WAAW;gBACrDM,MAAM;gBACN,GAAGL,OAAO;gBACV,GAAGb,qBAAqB;oBACpBmB,UAAU;gBACd,CAAC;YACL;YACA,IAAI,CAACH,WAAW;gBACZ;YACJ;YACA,IAAI,CAACzC,WAAWD,cAAc;gBAC1B,YAAY;gBACZ,mGAAmG;gBACnG0C,UAAUI,MAAM;gBAChB;YACJ;YACA5B,aAAakB,OAAO,GAAGM;YACvBA,UAAUK,QAAQ,GAAG9C,UAAU2B,gBAAgBK;YAC/C,OAAO;gBACHS,UAAUM,MAAM;YACpB;QACJ,GACA,uDAAuD;QACvD;YACI9B;YACAQ;YACAE;YACAK;YACAhC;SACH;QACD,IAAIY,SAAS;YACT,qBAAOP,OAAM2C,YAAY,CAACjC,OAAO;gBAC7BM;YACJ;QACJ;QACA,OAAO;IACX;IACA,OAAOnB;AACX"}